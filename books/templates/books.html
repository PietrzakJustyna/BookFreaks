{% extends "base.html" %}

{% block content %}

{% if category %}

{% if perms.book.change_category %}
    <a class="btn btn-primary" href="{% url 'modify_category' pk=category.pk %}" role="button">Modify category</a>
{% endif %}

{% if perms.book.delete_category %}
    <a class="btn btn-primary" href="{% url 'delete_category' pk=category.pk %}" role="button">Delete category</a>
{% endif %}
    <br>
    <br>
    <h1> BOOKS: {{category.category_name}}</h1>
    <hr>

{% else %}
     <h1> BOOKS </h1>
<hr>
{% endif %}

<form method="get" action="{% url 'books' %}">
    <select name="by_what">
        <option value="alpha">Alphabetically</option>
        <option value="rating">By rating</option>
    </select>
    <select name="how">
        <option value="asc">Ascending</option>
        <option value="desc">Descending</option>
    </select>
    <input type="submit" value="Sort">
    {% csrf_token %}
</form>

<br>

{% for book in books %}
<div class="card" >
  <div class="card-body">

    <h5 class="card-title">{{book.title}}</h5>
        <h5 class="card-title">Rating: {{book.average_rating}}</h5>
    {% for author in book.book_author.all %}

    <h6 class="card-subtitle mb-2 text-muted">{{author.name}} {{ author.surname}}</h6>
    {% endfor %}
    {% for category in book.book_category.all %}
    <p class="card-text">{{category.category_name}}</p>
    {% endfor %}
    <a href="{% url 'book' book.id %}" class="card-link">See details</a>

  </div>
</div>

{% empty %}
<h3>Nothing to show here yet</h3>
{% endfor %}

<nav aria-label="Book list pagination">
  <ul class="pagination justify-content-end">
    <li class="page-item">
           {% if books.has_previous %}
      <a class="page-link" href="?page={{ books.previous_page_number }}" aria-label="Previous">
        <span aria-hidden="true">&laquo;</span>
        <span class="sr-only">Previous</span>
              {% endif %}
      </a>
    </li>
       {% for num in books.paginator.page_range %}
        {% if books.number == num %}
      <li class="page-item"><a class="page-link" href="?page={{ num }}"><b>{{num}}</b></a></li>
      {% elif num > books.number|add:'-2' and num < books.number|add:'2' %}
      <li class="page-item"><a class="page-link" href="?page={{ num }}">{{num}}</a></li>
        {% endif %}
    {% endfor %}
    <li class="page-item">
            {% if books.has_next %}
      <a class="page-link" href="?page={{ books.next_page_number }}" aria-label="Next">
        <span aria-hidden="true">&raquo;</span>
        <span class="sr-only">Next</span>
          {% endif %}
      </a>
    </li>
  </ul>
</nav>


{% endblock %}
</div>
